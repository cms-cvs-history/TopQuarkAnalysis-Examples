process TQAF = {

  # initialize MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  replace MessageLogger.cerr.threshold = "WARNING"

  untracked PSet maxEvents = { untracked int32 input = 100 }


  ### FAMOS ###

  service =  RandomNumberGeneratorService {
    # This is to initialize the random engine of the source
    untracked uint32 sourceSeed = 123456789
    # This is to initialize the random engines of Famos
    PSet moduleSeeds = {
      untracked uint32 VtxSmeared = 123456789
      untracked uint32 famosSimHits = 13579
      untracked uint32 siTrackerGaussianSmearingRecHits = 24680
      untracked uint32 caloRecHits = 654321
      untracked uint32 paramMuons = 54525
    }
  }

  # Generate ttbar events
  include "FastSimulation/Configuration/data/ttbar.cfi"

  # Famos sequences
  include "FastSimulation/Configuration/data/FamosSequences.cff"
  // Parametrized magnetic field
  replace VolumeBasedMagneticFieldESProducer.useParametrizedTrackerField = true
  // You may not want to simulate everything for your study
  replace famosSimHits.SimulateCalorimetry = true
  replace famosSimHits.SimulateTracking = true
  replace famosSimHits.SimulatePileUp = false
  replace famosSimHits.SimulateMuons = true

  # Tracker MisAlignement 
  # include "FastSimulation/Configuration/data/MisAlignment.cff" 
  # ECAL miscalibration. 
  # include "FastSimulation/Configuration/data/MisCalibration.cff"

  path pf = { famosWithEverything }


  ### TQAF ###

  # perform high level reco tasks
  include "TopQuarkAnalysis/TopObjectProducers/data/TQAFHighLevelReco.cff"

  # build the TopObjects (TopJets, TopMuons, TopElectrons, TopMETs)
  include "TopQuarkAnalysis/TopObjectProducers/data/TopObjectProducers.cff"


  ### FAMOS replace statements ###

  // to use gsTracks
  replace jetTracksAssociator.tracks = gsWithMaterialTracks
  replace allLayer1TopBJets.trackAssociation.tracksSource = gsWithMaterialTracks
  replace allLayer1TopLJets.trackAssociation.tracksSource = gsWithMaterialTracks
  replace allLayer1TopElectrons.tracksSource = gsWithMaterialTracks
  // to use Famos muons
  replace allLayer1TopMETs.muonSource = "paramMuons:ParamGlobalMuons"
  replace allLayer1TopMuons.muonSource = "paramMuons:ParamGlobalMuons"


  ### Output ###

  path p = {
    tqafHighLevelReco,
    allTopObjects
  }

  module out = PoolOutputModule {
    untracked string fileName = "TQAFLayer1Output.root"
    untracked vstring outputCommands = {
      "drop *",
      "keep CrossingFrame_*_*_*",
      "keep edmTriggerResults_TriggerResults_*_*",
      "keep *_genParticleCandidates_*_*",
      "keep recoJetTags_*_*_*",
      "keep recoTracks_gsWithMaterialTracks_*_*",
      "keep *_offlinePrimaryVerticesFromCTFTracks_*_*",
      "keep *_selectedLayer1TopBJets_*_*",
      "keep *_selectedLayer1TopLJets_*_*",
      "keep *_selectedLayer1TopElectrons_*_*",
      "keep *_selectedLayer1TopMuons_*_*",
      "keep *_selectedLayer1TopMETs_*_*",
      "keep *_allLayer1TopTaus_*_*"
    }
    untracked bool verbose = false
  }

  endpath outpath = { out }

}
