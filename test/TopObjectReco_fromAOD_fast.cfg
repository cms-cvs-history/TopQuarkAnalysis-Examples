process TQAF = {

  # initialize MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  replace MessageLogger.cerr.threshold = "INFO"
  # return trigger report (including filter efficiencies)
  untracked PSet options = { untracked bool wantSummary = true }

//   source = PoolSource {
//     untracked vstring fileNames = { 'file:famos_aod_output.root' }
//   }
//   untracked PSet maxEvents = { untracked int32 input = -1 }
  include "TopQuarkAnalysis/Examples/test/tt0j_mT_70-alpgen.CMSSW_1_6_8-CSA07-3690-misAlCa0pb-FASTSIM.AODSIM.cfi"
  untracked PSet maxEvents = {untracked int32 input = 1000}


  ### TQAF ###

  # TQAF Layer 1 TopObject production
  include "TopQuarkAnalysis/TopObjectProducers/data/TQAFLayer1.cff"
  replace egammaElectronTkIsolation.trackProducer=gsWithMaterialTracks
  replace egammaElectronTkNumIsolation.trackProducer=gsWithMaterialTracks


  ### FAMOS replace statements ###

  // Muon isolation
  include "RecoMuon/MuonIsolationProducers/data/muIsolation.cff"
  path f = { muIsolation_ParamGlobalMuons }
  // to use famos gsTracks
  replace jetTracksAssociator.tracks = gsWithMaterialTracks
  replace allLayer1TopJets.trackAssociation.tracksSource = gsWithMaterialTracks
  replace allLayer1TopElectrons.tracksSource = gsWithMaterialTracks
  replace allLayer1TopMuons.tracksSource = gsWithMaterialTracks
  // to use famos muons
  replace allLayer1TopMETs.muonSource = paramMuons:ParamGlobalMuons
  replace allLayer1TopMuons.muonSource = paramMuons:ParamGlobalMuons
  replace allLayer1TopMuons.trackIsoSource = muParamGlobalIsoDepositGsTk
  replace allLayer1TopMuons.ecalIsoSource  = muParamGlobalIsoDepositCalEcal
  replace allLayer1TopMuons.hcalIsoSource  = muParamGlobalIsoDepositCalHcal
  replace allLayer1TopMuons.hocalIsoSource = famos

  ### Output ###
   
  // uncomment this line, when running over primary dataset containing 'GenParticleCandidate' instead of G'GenParticle'
  // (obligatory for primary datasets produced with CMSSW_1_6_7 or earlier!)
//   include "PhysicsTools/HepMCCandAlgos/data/genParticleCandidates2GenParticles.cfi"

  path p = {
  // uncomment this line, when running over primary dataset containing 'GenParticleCandidate' instead of G'GenParticle'
  // (obligatory for primary datasets produced with CMSSW_1_6_7 or earlier!)
//     genParticles,
    tqafLayer1
  }

  # to only accept events passing the complete path
  block EventSelection = {
    untracked PSet SelectEvents = {
      vstring SelectEvents = { "p" }
    }
  }

  module out = PoolOutputModule {
    untracked string fileName = "TQAFLayer1.tt0j_mT_70-alpgen.CMSSW_1_6_8-CSA07-3690-misAlCa0pb-FASTSIM.AODSIM.root"
    using EventSelection
    untracked vstring outputCommands = {
      "drop *",
      "keep edmTriggerResults_TriggerResults_*_*",
      "keep *_genParticles_*_*",
      "keep recoJetTags_*_*_*",
      "drop recoJetTags_coneIsolationTauJetTags_*_*",
      "keep recoTracks_gsWithMaterialTracks_*_*",
      "keep *_offlinePrimaryVerticesFromCTFTracks_*_*",
      "keep *_selectedLayer1TopElectrons_*_*",
      "keep *_selectedLayer1TopMuons_*_*",
      "keep *_selectedLayer1TopTaus_*_*",
      "keep *_selectedLayer1TopJets_*_*",
      "keep *_selectedLayer1TopMETs_*_*"
    }
    untracked bool verbose = false
  }

  endpath outpath = { out }

}
