process TQAF = {

  # initialize MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  replace MessageLogger.cerr.threshold = "WARNING"

  # input file
  include "TopQuarkAnalysis/Examples/test/RecoInput.cfi"

  # run the trigger
  include "HLTrigger/Configuration/data/main/HLTtable.cff"


  ### TQAF ###

  # TQAF Layer 1 TopObject production
  include "TopQuarkAnalysis/TopObjectProducers/data/TQAFLayer1.cff"
	  
  # TQAF Layer 2 for the ttbar semi-leptonic final state
  include "TopQuarkAnalysis/TopEventProducers/data/TQAFLayer2_TtSemi.cff"


  ### Output ###

  path p = {
    tqafLayer1,
    tqafLayer2_TtSemi
  }

  # to only accept events passing the complete path
  block EventSelection = {
    untracked PSet SelectEvents = {
      vstring SelectEvents = { "p" }
    }
  }

  module out = PoolOutputModule {
    untracked string fileName = "TQAFLayer2Output.root"
    using EventSelection
    untracked vstring outputCommands = {
      "drop *",
      "keep CrossingFrame_*_*_*",
      "keep edmTriggerResults_TriggerResults_*_*",
      "keep recoJetTags_*_*_*",
      "drop recoJetTags_coneIsolationTauJetTags_*_*",
      "keep recoTracks_ctfWithMaterialTracks_*_*",
      "keep *_offlinePrimaryVerticesFromCTFTracks_*_*",
      "keep *_selectedTopElectrons_*_*",
      "keep *_selectedTopMuons_*_*",
      "keep *_selectedTopTaus_*_*",
      "keep *_selectedTopLJets_*_*",
      "keep *_selectedTopBJets_*_*",
      "keep *_selectedTopMETs_*_*",
      "keep *_decaySubset_*_*",
      "keep *_genEvt_*_*",
      "keep *_solutions_*_*"
    }
    untracked bool verbose = false
  }

  endpath outpath = { out }

}
