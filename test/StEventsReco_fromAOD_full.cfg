process TQAF = {

  # initialize MessageLogger
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  replace MessageLogger.cerr.threshold = "WARNING"

  # input file
  source = PoolSource {
    untracked vstring fileNames = {
      '/store/RelVal/2007/9/3/RelVal-RelValZTT-1188837971/0002/0279DD81-655A-DC11-8280-0016177CA778.root'
      ### These were produced with 1_3_1 and will not work in this release:
      # 'rfio:/castor/cern.ch/user/g/giamman/SingleTop/reco_simu_0_99_tq_tqb_lhc_mu_0.root'
      # 'file:reco_simu_0_99_tq_tqb_lhc_mu_0.root'
      # 'rfio:/castor/cern.ch/user/g/giamman/SingleTop/singletop_mu_madgraph.root'
    }
  }
  untracked PSet maxEvents = { untracked int32 input = -1 }


  ### TQAF ###

  # TQAF Layer 1 TopObject production
  include "TopQuarkAnalysis/TopObjectProducers/data/TQAFLayer1.cff"

  # Construct the MC Generated Ttbar Event
  include "TopQuarkAnalysis/TopEventProducers/data/StGenEvtProducer.cff"

  # Count selection
  include "TopQuarkAnalysis/TopEventProducers/data/TtSemiNumJetFilter.cff"
  include "TopQuarkAnalysis/TopEventProducers/data/TtSemiNumLeptonFilter.cff"

  # StEvt solutions
  include "TopQuarkAnalysis/TopEventProducers/data/StEvtSolProducer.cfi"


  ### Output ###

  path p = {
    tqafLayer1,
    makeGenEvt,
    solutions
  }

  # to only accept events passing the complete path
  block EventSelection = {
    untracked PSet SelectEvents = {
      vstring SelectEvents = { "p" }
    }
  }

  module out = PoolOutputModule {
    untracked string fileName = "TQAFLayer2Output.root"
    using EventSelection
    untracked vstring outputCommands = {
      "drop *",
      "keep edmTriggerResults_TriggerResults_*_*",
      "keep recoJetTags_*_*_*",
      "drop recoJetTags_coneIsolationTauJetTags_*_*",
      "keep recoTracks_gsWithMaterialTracks_*_*",
      "keep *_offlinePrimaryVerticesFromCTFTracks_*_*",
      "keep *_selectedLayer1Jets_*_*",
      "keep *_selectedLayer1Electrons_*_*",
      "keep *_selectedLayer1Muons_*_*",
      "keep *_selectedLayer1METs_*_*",
#     "keep *_allLayer1Taus_*_*",
      "keep *_initSubset_*_*",
      "keep *_decaySubset_*_*",
      "keep *_genEvt_*_*",
      "keep *_solutions_*_*"
    }
    untracked bool verbose = false
  }

  endpath outpath = { out }
}
